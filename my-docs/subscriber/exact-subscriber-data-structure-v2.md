# üì± WhatsApp Subscriber Data Structure V2

> **üìé –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
> - [Webhook Payload Specification](../incoming-webhooks/webhook-payload-specification.md) - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ö–æ–¥—è—â–∏—Ö webhook
> - –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –≤ –ë–î

---

## ‚úÖ –ë–ê–ó–û–í–´–ï –î–ê–ù–ù–´–ï (–∏–∑ –ø–µ—Ä–≤–æ–≥–æ webhook)

–≠—Ç–∏ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

### üÜî –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

**`id`** - UUID –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ
```json
"550e8400-e29b-41d4-a716-446655440000"
```

**`tenantId`** - ID –∞—Ä–µ–Ω–¥–∞—Ç–æ—Ä–∞ (–º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å)
```json
"tenant_12345"
```

**`waPhone`** - WhatsApp –Ω–æ–º–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ E.164
```json
"+15551234567"  // –°–®–ê
"+380671234567" // –£–∫—Ä–∞–∏–Ω–∞  
"+447911123456" // –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è
```

**`waId`** - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π ID –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (Cloud API/Gupshup)
```json
"15551234567"     // Cloud API format
"15551234567@s.whatsapp.net"  // Gupshup format
```

**`phoneHash`** - SHA256 —Ö—ç—à –Ω–æ–º–µ—Ä–∞ –¥–ª—è Facebook CAPI –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```json
"a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"
```

> üí° **–ú–∞–ø–ø–∏–Ω–≥ –∏–∑ webhook:** –î–µ—Ç–∞–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ–ª–µ–π –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ —Å–º. –≤ [webhook-payload-specification.md](../incoming-webhooks/webhook-payload-specification.md#field-mapping)

---

### üë§ –ü—Ä–æ—Ñ–∏–ª—å WhatsApp

**`profileName`**  
–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ WhatsApp (–º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏–∑-–∑–∞ privacy)  
```
"John Doe"
"Maria üå∏"  
"+1 555 123-4567"  // –ò–Ω–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–∏ –Ω–æ–º–µ—Ä
null              // –ï—Å–ª–∏ —Å–∫—Ä—ã—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
```

---

### üí¨ –°–µ—Å—Å–∏—è –∏ —Ä–∞–∑–≥–æ–≤–æ—Ä

**`conversationId`**  
–£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ 24-—á–∞—Å–æ–≤–æ–π —Å–µ—Å—Å–∏–∏  
```
"gBEGkYiEB1VXAglK1ZEqA1YKPrU"
```
‚ö° –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ç–∞—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ WhatsApp Business

**`conversationExpiresAt`**  
–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ 24-—á–∞—Å–æ–≤–æ–≥–æ –æ–∫–Ω–∞ (Unix timestamp –≤ –º—Å)  
```
1736539200000  // = 10 Jan 2025 12:00:00 UTC
null           // –ï—Å–ª–∏ –æ–∫–Ω–æ –∞–∫—Ç–∏–≤–Ω–æ
```
üí° –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è –Ω—É–∂–Ω—ã template messages

---

### üìä –°—Ç–∞—Ç—É—Å—ã –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

**`lastMessageStatus`**  
–ü–æ—Å–ª–µ–¥–Ω–∏–π —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏—è  
```
"received"   // –í—Ö–æ–¥—è—â–µ–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ)
"sent"       // –ò—Å—Ö–æ–¥—è—â–µ–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
"delivered"  // –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
"read"       // –ü—Ä–æ—á–∏—Ç–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º  
"failed"     // –û—à–∏–±–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
```

**`lastMessageStatusAt`**  
–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏—è (Unix timestamp –≤ –º—Å)  
```
1736535600000  // = 10 Jan 2025 11:00:00 UTC
```

**`firstSeenAt`**  
–ü–µ—Ä–≤–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ  
```
1736535600000
```

**`lastInboundAt`**  
–ü–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
```
1736535600000
```

**`inboundCount`**  
–°—á—ë—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 1)  
```
1
```

---

### ‚öôÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è

**`status`**  
–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å—á–∏–∫–∞ –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ  
```
"active"     // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
"inactive"   // –î–æ–ª–≥–æ –Ω–µ –ø–∏—Å–∞–ª
"blocked"    // –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞–º–∏
"opted_out"  // –û—Ç–ø–∏—Å–∞–ª—Å—è —á–µ—Ä–µ–∑ STOP
```

**`rawLastEventType`**  
–¢–∏–ø –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ webhook —Å–æ–±—ã—Ç–∏—è –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞  
```
"message"        // –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
"message-event"  // –°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏  
"user-event"     // Opt-in/opt-out
"sandbox-start"  // –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
```

**`rawVersion`**  
–í–µ—Ä—Å–∏—è API –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞  
```
"v3"  // –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è
"v2"  // Legacy
```

---

## üéØ –ï–°–õ–ò –ü–†–ò–®–Å–õ –ß–ï–†–ï–ó –†–ï–ö–õ–ê–ú–£ (referral –±–ª–æ–∫)

–≠—Ç–∏ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—à—ë–ª –ø–æ —Ä–µ–∫–ª–∞–º–Ω–æ–π —Å—Å—ã–ª–∫–µ Facebook/Instagram.

> üí° **–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è referral –±–ª–æ–∫–∞** –≤ webhook —Å–º. [webhook-payload-specification.md](../incoming-webhooks/webhook-payload-specification.md#referral)

### –ê—Ç—Ä–∏–±—É—Ü–∏—è Click-to-WhatsApp

**`ctwaClid`**  
Facebook Click ID –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–π  
```
"fb.1.1736535600.IwAR123abcDEF456ghiJKL789mno"
```
üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è Facebook CAPI –∏ –∞—Ç—Ä–∏–±—É—Ü–∏–∏

**`referral.sourceUrl`**  
–ü–æ–ª–Ω—ã–π URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞  
```
"https://m.me/yourbusiness?ref=ad_campaign"
"https://wa.me/15551234567?text=hello"  
"https://business.facebook.com/latest/inbox/all?asset_id=123456"
```

**`referral.sourceType`**  
–¢–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ç—Ä–∞—Ñ–∏–∫–∞  
```
"ad"       // –†–µ–∫–ª–∞–º–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
"post"     // –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–æ—Å—Ç
"page"     // –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–∏–∑–Ω–µ—Å–∞
"website"  // –í–Ω–µ—à–Ω–∏–π —Å–∞–π—Ç
```

**`referral.sourceId`**  
Facebook ID –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–±—ä—è–≤–ª–µ–Ω–∏–µ/–ø–æ—Å—Ç/—Å—Ç—Ä–∞–Ω–∏—Ü–∞)  
```
"120210000000000000"  // ID —Ä–µ–∫–ª–∞–º—ã
"100044123456789"     // ID –ø–æ—Å—Ç–∞  
"108123456789012345"  // ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```

**`referral.headline`**  
–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è  
```
"–ù–∞—á–Ω–∏ —á–∞—Ç —Å –Ω–∞–º–∏"
"–°–∫–∏–¥–∫–∞ 50% —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è"
"–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —ç–∫—Å–ø–µ—Ä—Ç–∞"
```

**`referral.body`**  
–¢–µ–∫—Å—Ç –æ–ø–∏—Å–∞–Ω–∏—è –≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏  
```
"–ü–æ–ª—É—á–∏ —Å–∫–∏–¥–∫—É 20% –Ω–∞ –ø–µ—Ä–≤—É—é –ø–æ–∫—É–ø–∫—É"
"–ù–∞–ø–∏—à–∏ –Ω–∞–º –≤ WhatsApp –∏ —É–∑–Ω–∞–π –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏"
"–û—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –∑–∞ 5 –º–∏–Ω—É—Ç"
```

**`referral.mediaType`**  
–¢–∏–ø –º–µ–¥–∏–∞ –≤ —Ä–µ–∫–ª–∞–º–µ  
```
"image"     // –°—Ç–∞—Ç–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞
"video"     // –í–∏–¥–µ–æ
"carousel"  // –ö–∞—Ä—É—Å–µ–ª—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

**`referral.imageUrl`**  
URL –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ —Ç–∏–ø = image)  
```
"https://scontent.xx.fbcdn.net/v/t45.1600-4/123456_789012345_n.jpg"
```

---

## üìã –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô JSON (–ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)

### –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–æ—Ä–≥–∞–Ω–∏–∫–∞)
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "tenantId": "tenant_12345",
  "waPhone": "+15551234567",
  "phoneHash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "profileName": "John Doe",
  "conversationId": "gBEGkYiEB1VXAglK1ZEqA1YKPrU",
  "conversationExpiresAt": 1736539200000,
  "lastMessageStatus": "received",
  "lastMessageStatusAt": 1736535600000,
  "firstSeenAt": 1736535600000,
  "lastInboundAt": 1736535600000,
  "inboundCount": 1,
  "status": "active",
  "rawLastEventType": "message",
  "rawVersion": "v3"
}
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ —Ä–µ–∫–ª–∞–º—ã (—Å referral)
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "tenantId": "tenant_12345",
  "waPhone": "+15551234567",
  "phoneHash": "a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3",
  "profileName": "Maria Garcia",
  "conversationId": "gBEGkYiEB1VXAglK1ZEqA1YKPrU",
  "conversationExpiresAt": 1736539200000,
  "lastMessageStatus": "received",
  "lastMessageStatusAt": 1736535600000,
  "firstSeenAt": 1736535600000,
  "lastInboundAt": 1736535600000,
  "inboundCount": 1,
  "status": "active",
  "rawLastEventType": "message",
  "rawVersion": "v3",
  "ctwaClid": "fb.1.1736535600.IwAR123abcDEF456ghiJKL789mno",
  "referral": {
    "sourceUrl": "https://m.me/yourbusiness?ref=summer_sale",
    "sourceType": "ad",
    "sourceId": "120210000000000000",
    "headline": "–°–∫–∏–¥–∫–∞ 50% —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è",
    "body": "–ù–∞–ø–∏—à–∏ –Ω–∞–º –≤ WhatsApp –∏ –ø–æ–ª—É—á–∏ –ø—Ä–æ–º–æ–∫–æ–¥",
    "mediaType": "video",
    "imageUrl": null
  }
}
```

---

## ‚è±Ô∏è –ü–û–Ø–í–ò–¢–°–Ø –ü–û–ó–ñ–ï (—Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ —Å–æ–±—ã—Ç–∏–π)

### –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- **`lastOutboundMessageId`** ‚Äî ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∏—Å—Ö–æ–¥—è—â–µ–≥–æ (`gsId` –∏–ª–∏ `wamid`)
- **`lastOutboundAt`** ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
- **`outboundCount`** ‚Äî —Å—á—ë—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –ü—Ä–∏ —Å—Ç–∞—Ç—É—Å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö
- **`lastDeliveredAt`** ‚Äî –∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ (status=delivered)
- **`lastReadAt`** ‚Äî –∫–æ–≥–¥–∞ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ (status=read)
- **`lastFailedAt`** ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—à–∏–±–∫–∏
- **`lastFailedCode`** ‚Äî –∫–æ–¥ –æ—à–∏–±–∫–∏ (470, 1002, etc)
- **`lastFailedReason`** ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏

### User events
- **`optInStatus`** ‚Äî true/false (–ø–æ—Å–ª–µ opted-in/opted-out —Å–æ–±—ã—Ç–∏—è)
- **`optInAt`** ‚Äî –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–∏—è
- **`optOutAt`** ‚Äî –≤—Ä–µ–º—è –æ—Ç–ø–∏—Å–∫–∏

### Lifecycle (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
- **`lifecycleState`** ‚Äî lead ‚Üí prospect ‚Üí customer ‚Üí repeat_customer
- **`lifecycleChangedAt`** ‚Äî –≤—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–∏
- **`lifecycleScore`** ‚Äî –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ª–∏–¥–∞ (0-100)

---

## üîÑ –û–ë–û–ì–ê–©–ï–ù–ò–ï (–≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)

### üåç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è (IP lookup / phone parsing)
- **`city`** ‚Äî "New York"
- **`state`** ‚Äî "NY"
- **`country`** ‚Äî "US"
- **`timezone`** ‚Äî "America/New_York"
- **`postalCode`** ‚Äî "10001"

### üéØ UTM –º–µ—Ç–∫–∏ (–ø–∞—Ä—Å–∏–Ω–≥ referral.sourceUrl)
- **`utmSource`** ‚Äî "facebook"
- **`utmMedium`** ‚Äî "cpc"
- **`utmCampaign`** ‚Äî "summer_sale_2025"
- **`utmContent`** ‚Äî "video_testimonial"
- **`utmTerm`** ‚Äî "discount_whatsapp"

### üìä Facebook Ads (Marketing API –ø–æ ctwaClid)
- **`campaignId`** ‚Äî "23850123456789012"
- **`campaignName`** ‚Äî "Summer Sale 2025"
- **`adsetId`** ‚Äî "23850123456789013"
- **`adsetName`** ‚Äî "Lookalike 1% Purchasers"
- **`adId`** ‚Äî "23850123456789014"
- **`adName`** ‚Äî "Video - 50% Off"
- **`creativeId`** ‚Äî "23850123456789015"
- **`creativeName`** ‚Äî "Summer Promo Video v3"
- **`placement`** ‚Äî "instagram_stories"
- **`publisherPlatform`** ‚Äî "instagram"

### üí∞ Commerce (Stripe API/webhooks)
- **`stripeCustomerId`** ‚Äî "cus_P1234567890"
- **`totalRevenue`** ‚Äî 1250.00
- **`purchaseCount`** ‚Äî 3
- **`averageOrderValue`** ‚Äî 416.67
- **`lifetimeValue`** ‚Äî 1250.00
- **`firstPurchaseAt`** ‚Äî timestamp
- **`lastPurchaseAt`** ‚Äî timestamp
- **`subscriptions[]`** ‚Äî –º–∞—Å—Å–∏–≤ –ø–æ–¥–ø–∏—Å–æ–∫

### ü§ù CRM (Kommo/HubSpot/Salesforce)
- **`crmContactId`** ‚Äî –≤–Ω–µ—à–Ω–∏–π ID –≤ CRM
- **`crmLeadId`** ‚Äî ID —Å–¥–µ–ª–∫–∏/–ª–∏–¥–∞
- **`leadScore`** ‚Äî 85 (scoring –º–æ–¥–µ–ª—å)
- **`crmStage`** ‚Äî "qualified"
- **`responsibleManager`** ‚Äî "user_123"
- **`customFields`** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è CRM

### üìà –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
- **`totalSessions`** ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
- **`totalSessionDuration`** ‚Äî –æ–±—â–µ–µ –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- **`averageEngagementScore`** ‚Äî —Å—Ä–µ–¥–Ω–∏–π engagement (0-10)
- **`lastSessionId`** ‚Äî ID –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏
- **`lastSessionAt`** ‚Äî –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏
- **`daysSinceLastActivity`** ‚Äî –¥–Ω–µ–π —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **`conversionProbability`** ‚Äî –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ (0-100%)

### üë• Facebook –¥–∞–Ω–Ω—ã–µ (Graph API)
- **`facebookUserId`** ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π Facebook ID
- **`facebookPageScopedUserId`** ‚Äî ID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- **`facebookAudiences[]`** ‚Äî —Å–ø–∏—Å–æ–∫ Custom Audiences
- **`lookalikesAudiences[]`** ‚Äî —Å–ø–∏—Å–æ–∫ Lookalike –∞—É–¥–∏—Ç–æ—Ä–∏–π

### üìù –ü—Ä–æ—Ñ–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–æ—Ä–º—ã/–∏–º–ø–æ—Ä—Ç)
- **`firstName`** ‚Äî "John"
- **`lastName`** ‚Äî "Doe"
- **`fullName`** ‚Äî "John Doe"
- **`email`** ‚Äî "john.doe@example.com"
- **`emailHash`** ‚Äî SHA256 –¥–ª—è CAPI
- **`language`** ‚Äî "en"
- **`profilePictureUrl`** ‚Äî URL –∞–≤–∞—Ç–∞—Ä–∞

### üè∑Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
- **`contactUuid`** ‚Äî –≥–ª–∞–≤–Ω—ã–π UUID –¥–ª—è cross-system –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
- **`externalId`** ‚Äî –≤–Ω–µ—à–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
- **`tags[]`** ‚Äî –º–∞—Å—Å–∏–≤ —Ç–µ–≥–æ–≤ ["vip", "high_value"]
- **`customFields`** ‚Äî –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è
- **`metadata`** ‚Äî —Å–ª—É–∂–µ–±–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **`preferredChannel`** ‚Äî –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏
- **`channels[]`** ‚Äî –≤—Å–µ –∫–∞–Ω–∞–ª—ã [{type: "whatsapp", verified: true}]

### üìä –ò—Å—Ç–æ—Ä–∏—è –∏ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- **`conversions[]`** ‚Äî –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –∫–æ–Ω–≤–µ—Ä—Å–∏–π —Å –¥–µ—Ç–∞–ª—å–Ω–æ–π –∞—Ç—Ä–∏–±—É—Ü–∏–µ–π
- **`lifecycleHistory[]`** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **`interactions[]`** ‚Äî –∏—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π

### ‚úÖ –§–ª–∞–≥–∏ –æ–±–æ–≥–∞—â–µ–Ω–∏—è
- **`gupshupEnriched`** ‚Äî –¥–∞–Ω–Ω—ã–µ –∏–∑ Gupshup –ø–æ–ª—É—á–µ–Ω—ã
- **`stripeEnriched`** ‚Äî –¥–∞–Ω–Ω—ã–µ Stripe —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- **`kommoEnriched`** ‚Äî CRM –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
- **`facebookSynced`** ‚Äî Facebook –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã
- **`isOptedIn`** ‚Äî —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∏
- **`isBot`** ‚Äî —Ñ–ª–∞–≥ –±–æ—Ç–∞ (false –¥–ª—è –ª—é–¥–µ–π)

---

## üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–¶–ï–°–°–´

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è:

| –ü—Ä–æ—Ü–µ—Å—Å           | –ö–æ–≥–¥–∞                | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                      | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-------------------|----------------------|-------------------------------------------------|-----------|
| **CAPI Event**    | –°—Ä–∞–∑—É                | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç "Contact" —Å–æ–±—ã—Ç–∏–µ –≤ Facebook         | P0        |
| **Audience Add**  | 1-2 —Å–µ–∫              | –î–æ–±–∞–≤–ª—è–µ—Ç –≤ Custom Audience "All WhatsApp Users" | P0        |
| **CRM Create**    | 2-5 —Å–µ–∫              | –°–æ–∑–¥–∞—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç –≤ CRM –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç        | P1        |
| **Enrichment**    | 5-10 —Å–µ–∫             | –ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è                   | P1        |
| **Analytics**     | 10-30 —Å–µ–∫            | –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –¥–∞—à–±–æ—Ä–¥—ã                   | P2        |
| **Attribution**   | –ï—Å–ª–∏ –µ—Å—Ç—å ctwaClid   | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏ –∏–∑ Facebook          | P0        |
| **Stripe Check**  | 30-60 —Å–µ–∫            | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–ª–∞—Ç–µ–∂–∏                 | P2        |

---

## üìö –°–ü–†–ê–í–û–ß–ù–´–ï –°–°–´–õ–ö–ò

- **Gupshup Webhooks:** https://docs.gupshup.io/docs/inbound-messages-events
- **Facebook CTWA:** https://developers.facebook.com/docs/whatsapp/conversation-types/
- **Facebook CAPI:** https://developers.facebook.com/docs/marketing-api/conversions-api/
- **Facebook Audiences:** https://developers.facebook.com/docs/marketing-api/audiences/
- **Stripe Webhooks:** https://stripe.com/docs/webhooks
- **Kommo API:** https://developers.kommo.com/docs/kommo-for-developers